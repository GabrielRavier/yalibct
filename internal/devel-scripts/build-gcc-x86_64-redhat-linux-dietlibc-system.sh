#!/usr/bin/env bash
CC='diet gcc' \
    cmake \
        -B build/dietlibc-system \
        -Werror=dev -Werror=deprecated --warn-uninitialized `# All of the CMake warning options that seem useful` \
        -DCMAKE_C_FLAGS='-ggdb3 -Wno-deprecated-declarations' \
        -DYALIBCT_LIBC_DOESNT_HAVE_NAN=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Add-NAN-to-math.h-as-required-by-C99.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_FCVT=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_ECVT=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_VSWPRINTF=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_FWPRINTF=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_SWPRINTF=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_VFWPRINTF=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_FESETROUND=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_INFINITY=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Added-HUGE_VALL-and-INFINITY-both-from-C99-and-requi.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_NL_ARGMAX=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_STATIC_ASSERT=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_FEGETROUND=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_LDEXP=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_LOG=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_POW=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_EXP=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_FLOOR=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_FREXP=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_VDPRINTF=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_DPRINTF=ON `# Implemented in trunk but not as of dietlibc 0.34` \
        -DYALIBCT_LIBC_DOESNT_HAVE_OPEN_MEMSTREAM=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_WCSCASECMP=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_STRUCT_STAT_ST_ATIM=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_STRUCT_STAT_ST_MTIM=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_STRUCT_STAT_ST_CTIM=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_O_SEARCH=ON `# Not yet implemented` \
        -DYALIBCT_LIBC_DOESNT_HAVE_UTIME_NOW=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Add-UTIME_NOW-UTIME_OMIT-and-fix-declaration-of-utim.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_UTIME_OMIT=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Add-UTIME_NOW-UTIME_OMIT-and-fix-declaration-of-utim.patch` \
        -DYALIBCT_DISABLE_PRINTF_UPPERCASE_L_LENGTH_MODIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_HASH_FLAG_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-not-working-properly.patch` \
        -DYALIBCT_DISABLE_PRINTF_HH_LENGTH_MODIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/patch-fix-printf-not-formatting-values-of-narrowed-types-correctly` \
        -DYALIBCT_DISABLE_PRINTF_PRECISION_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-fix-Make-it-so-negative-precision-arguments-work-pro.patch` \
        -DYALIBCT_DISABLE_PRINTF_A_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_E_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_LOWERCASE_F_CONVERSION_SPECIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Properly-handle-negative-0-in-printf-when-plus-flag-.patch` \
        -DYALIBCT_DISABLE_PRINTF_0_FLAG_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-printf-not-ignoring-0-flag-when-precision-is-spe.patch` \
        -DYALIBCT_DISABLE_PRINTF_C_CONVERSION_SPECIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/patch-made-it-so-c-supports-more-than-very-basic-formatting` \
        -DYALIBCT_DISABLE_PRINTF_L_FLAG_ON_C_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_L_FLAG_ON_S_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_LOWERCASE_B_CONVERSION_SPECIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Add-B-conversion-specifier-to-printf-and-alternative.patch` \
        -DYALIBCT_DISABLE_PRINTF_UPPERCASE_B_CONVERSION_SPECIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Add-B-conversion-specifier-to-printf-and-alternative.patch` \
        -DYALIBCT_DISABLE_PRINTF_ROUNDING_DIRECTION_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/bug-report-printf-f-1-7976931348623157e-308-crashes-with-a-stack-overflow` \
        -DYALIBCT_DISABLE_PRINTF_NUMBERED_ARGUMENTS_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_APOSTROPHE_FLAG_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_G_CONVERSION_SPECIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/bug-report-printf-g-1234567-8-does-not-print-correctly-and-fails-to-null-terminate-an-internal-buffer` \
        -DYALIBCT_DISABLE_PRINTF_T_LENGTH_MODIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Added-t-conversion-specifier-to-printf.patch` \
        -DYALIBCT_DISABLE_PRINTF_UPPERCASE_C_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_UPPERCASE_S_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_PRINTF_N_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_SCANF_J_LENGTH_MODIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Added-j-z-and-t-support-to-scanf.patch` \
        -DYALIBCT_DISABLE_SCANF_Z_LENGTH_MODIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Added-j-z-and-t-support-to-scanf.patch` \
        -DYALIBCT_DISABLE_SCANF_T_LENGTH_MODIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Added-j-z-and-t-support-to-scanf.patch` \
        -DYALIBCT_DISABLE_SCANF_LOWERCASE_F_CONVERSION_SPECIFIER_TESTS=ON `# Not yet implemented properly` \
        -DYALIBCT_DISABLE_SCANF_NUMBERED_ARGUMENTS_TESTS=ON `# Not yet implemented` \
        -DYALIBCT_DISABLE_SCANF_P_CONVERSION_SPECIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-p-in-scanf.patch` \
        -DYALIBCT_DISABLE_PRINTF_H_LENGTH_MODIFIER_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/patch-fix-printf-not-formatting-values-of-narrowed-types-correctly` \
        -DYALIBCT_LIBC_DOESNT_HAVE_WCSNCMP=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-wcsncmp-going-past-the-end-of-the-string-if-n-is.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_STRNLEN=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-memchr-failing-to-find-matches-when-len-is-massi.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_MEMCHR=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-memchr-failing-to-find-matches-when-len-is-massi.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_STRCASECMP=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-strcasecmp-on-negative-and-close-to-limits-numbe.patch` \
        -DYALIBCT_LIBC_DOESNT_HAVE_WCSCMP=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-fix-return-value-of-wcs-n-cmp-for-near-limits-signed.patch` \
        -DYALIBCT_DISABLE_PRINTF_ERRNO_TESTS=ON `# See https://github.com/GabrielRavier/dietlibc-bug-reports-and-patches/blob/master/0001-Fix-printf-not-setting-errno-on-MAX_WIDTH-errors.patch` \
&& \
    cmake --build build/dietlibc-system --parallel 14
